# æ–‡æ¡£ç”Ÿæˆå’Œéƒ¨ç½²å·¥ä½œæµ
# ç”¨äºè‡ªåŠ¨ç”Ÿæˆå’Œéƒ¨ç½²é¡¹ç›®æ–‡æ¡£

name: Documentation

# è§¦å‘æ¡ä»¶
on:
  push:
    branches: [ main, develop ]
    paths:
      - '*.py'
      - 'docs/**'
      - 'README*.md'
      - 'CHANGELOG.md'
      - '.github/workflows/docs.yml'
  pull_request:
    branches: [ main ]
    paths:
      - '*.py'
      - 'docs/**'
      - 'README*.md'
  release:
    types: [published]
  workflow_dispatch:
    inputs:
      deploy_docs:
        description: 'Deploy documentation to GitHub Pages'
        required: false
        type: boolean
        default: false

# ç¯å¢ƒå˜é‡
env:
  PYTHONUNBUFFERED: 1
  PYTHONDONTWRITEBYTECODE: 1

# æƒé™è®¾ç½®
permissions:
  contents: read
  pages: write
  id-token: write

# å¹¶å‘æ§åˆ¶
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  # ç”Ÿæˆ API æ–‡æ¡£
  generate-api-docs:
    name: Generate API Documentation
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        cache: 'pip'
        
    - name: Install documentation tools
      run: |
        python -m pip install --upgrade pip
        pip install sphinx sphinx-rtd-theme sphinx-autodoc-typehints
        pip install myst-parser sphinx-copybutton sphinx-tabs
        pip install numpy>=1.19.0
        
    - name: Create docs directory structure
      run: |
        mkdir -p docs/source
        mkdir -p docs/build
        mkdir -p docs/source/_static
        mkdir -p docs/source/_templates
        
    - name: Generate Sphinx configuration
      run: |
        cat > docs/source/conf.py << 'EOF'
        # Sphinx é…ç½®æ–‡ä»¶
        import os
        import sys
        
        # æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ° Python è·¯å¾„
        sys.path.insert(0, os.path.abspath('../..'))
        
        # é¡¹ç›®ä¿¡æ¯
        project = 'Manimlib Modules'
        copyright = '2024, Manimlib Contributors'
        author = 'Manimlib Contributors'
        
        # ç‰ˆæœ¬ä¿¡æ¯
        try:
            import animation
            version = animation.__version__
            release = version
        except ImportError:
            version = '2.0.0'
            release = '2.0.0'
        
        # æ‰©å±•
        extensions = [
            'sphinx.ext.autodoc',
            'sphinx.ext.viewcode',
            'sphinx.ext.napoleon',
            'sphinx.ext.intersphinx',
            'sphinx_autodoc_typehints',
            'myst_parser',
            'sphinx_copybutton',
            'sphinx_tabs.tabs',
        ]
        
        # æ¨¡æ¿è·¯å¾„
        templates_path = ['_templates']
        
        # æ’é™¤æ¨¡å¼
        exclude_patterns = []
        
        # HTML è¾“å‡ºé€‰é¡¹
        html_theme = 'sphinx_rtd_theme'
        html_static_path = ['_static']
        html_title = f'{project} v{version}'
        
        # HTML ä¸»é¢˜é€‰é¡¹
        html_theme_options = {
            'canonical_url': '',
            'analytics_id': '',
            'logo_only': False,
            'display_version': True,
            'prev_next_buttons_location': 'bottom',
            'style_external_links': False,
            'vcs_pageview_mode': '',
            'style_nav_header_background': '#2980B9',
            'collapse_navigation': True,
            'sticky_navigation': True,
            'navigation_depth': 4,
            'includehidden': True,
            'titles_only': False
        }
        
        # Autodoc é€‰é¡¹
        autodoc_default_options = {
            'members': True,
            'member-order': 'bysource',
            'special-members': '__init__',
            'undoc-members': True,
            'exclude-members': '__weakref__'
        }
        
        # Napoleon è®¾ç½®
        napoleon_google_docstring = True
        napoleon_numpy_docstring = True
        napoleon_include_init_with_doc = False
        napoleon_include_private_with_doc = False
        napoleon_include_special_with_doc = True
        napoleon_use_admonition_for_examples = False
        napoleon_use_admonition_for_notes = False
        napoleon_use_admonition_for_references = False
        napoleon_use_ivar = False
        napoleon_use_param = True
        napoleon_use_rtype = True
        
        # Intersphinx æ˜ å°„
        intersphinx_mapping = {
            'python': ('https://docs.python.org/3', None),
            'numpy': ('https://numpy.org/doc/stable/', None),
        }
        
        # MyST è§£æå™¨è®¾ç½®
        myst_enable_extensions = [
            "colon_fence",
            "deflist",
            "html_admonition",
            "html_image",
            "linkify",
            "replacements",
            "smartquotes",
            "substitution",
            "tasklist",
        ]
        EOF
        
    - name: Generate main documentation index
      run: |
        cat > docs/source/index.rst << 'EOF'
        Manimlib Modules Documentation
        ==============================
        
        æ¬¢è¿ä½¿ç”¨ Manimlib Modules æ–‡æ¡£ï¼è¿™æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„ Python åŠ¨ç”»åº“æ¨¡å—é›†åˆã€‚
        
        .. toctree::
           :maxdepth: 2
           :caption: å†…å®¹ç›®å½•:
        
           overview
           installation
           quickstart
           api/index
           examples/index
           changelog
           contributing
        
        æ¨¡å—æ¦‚è§ˆ
        ========
        
        Manimlib Modules åŒ…å«ä»¥ä¸‹æ ¸å¿ƒæ¨¡å—ï¼š
        
        * **Animation Module**: æ ¸å¿ƒåŠ¨ç”»åŠŸèƒ½
        * **Composition Module**: åŠ¨ç”»ç»„åˆå’Œç¼–æ’
        * **Creation Module**: å¯¹è±¡åˆ›å»ºå’Œæ“ä½œ
        
        ç‰¹æ€§
        ====
        
        * ğŸ ç°ä»£ Python 3.8+ å…¼å®¹æ€§
        * ğŸ“ å®Œæ•´çš„ç±»å‹æ³¨è§£æ”¯æŒ
        * ğŸ“š å…¨é¢çš„æ–‡æ¡£å­—ç¬¦ä¸²
        * ğŸ›¡ï¸ å¢å¼ºçš„é”™è¯¯å¤„ç†æœºåˆ¶
        * âš¡ æ€§èƒ½ä¼˜åŒ–å’Œæ”¹è¿›
        * ğŸ§ª å¹¿æ³›çš„æµ‹è¯•è¦†ç›–
        
        ç´¢å¼•å’Œè¡¨æ ¼
        ===========
        
        * :ref:`genindex`
        * :ref:`modindex`
        * :ref:`search`
        EOF
        
    - name: Generate API documentation
      run: |
        mkdir -p docs/source/api
        
        # ç”Ÿæˆ API ç´¢å¼•
        cat > docs/source/api/index.rst << 'EOF'
        API å‚è€ƒ
        ========
        
        è¿™é‡Œæ˜¯ Manimlib Modules çš„å®Œæ•´ API å‚è€ƒæ–‡æ¡£ã€‚
        
        .. toctree::
           :maxdepth: 2
        
           animation
           composition
           creation
        EOF
        
        # ä¸ºæ¯ä¸ªæ¨¡å—ç”Ÿæˆ API æ–‡æ¡£
        modules=("animation" "composition" "creation")
        
        for module in "${modules[@]}"; do
          if [ -f "${module}.py" ]; then
            cat > "docs/source/api/${module}.rst" << EOF
        ${module^} Module
        $(printf '=%.0s' {1..20})
        
        .. automodule:: ${module}
           :members:
           :undoc-members:
           :show-inheritance:
           :special-members: __init__
        
        Classes
        -------
        
        .. currentmodule:: ${module}
        
        EOF
            
            # æå–ç±»åå¹¶æ·»åŠ åˆ°æ–‡æ¡£
            python -c "
        try:
            import ${module}
            import inspect
            
            classes = [name for name, obj in inspect.getmembers(${module}, inspect.isclass) 
                      if obj.__module__ == '${module}']
            
            if classes:
                with open('docs/source/api/${module}.rst', 'a') as f:
                    for cls in classes:
                        f.write(f'.. autoclass:: {cls}\n')
                        f.write('   :members:\n')
                        f.write('   :inherited-members:\n')
                        f.write('   :show-inheritance:\n\n')
        except ImportError:
            print('Module ${module} not found, skipping class extraction')
        "
          fi
        done
        
    - name: Generate additional documentation pages
      run: |
        # æ¦‚è§ˆé¡µé¢
        cat > docs/source/overview.md << 'EOF'
        # é¡¹ç›®æ¦‚è§ˆ
        
        Manimlib Modules æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„ Python åŠ¨ç”»åº“æ¨¡å—é›†åˆï¼Œä¸“ä¸ºåˆ›å»ºé«˜è´¨é‡çš„æ•°å­¦åŠ¨ç”»è€Œè®¾è®¡ã€‚
        
        ## è®¾è®¡ç†å¿µ
        
        - **æ¨¡å—åŒ–**: æ¯ä¸ªæ¨¡å—ä¸“æ³¨äºç‰¹å®šåŠŸèƒ½
        - **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ç±»å‹æ³¨è§£æ”¯æŒ
        - **æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„æ–‡æ¡£å­—ç¬¦ä¸²å’Œç¤ºä¾‹
        - **æ€§èƒ½ä¼˜åŒ–**: é«˜æ•ˆçš„ç®—æ³•å’Œæ•°æ®ç»“æ„
        - **æ˜“äºä½¿ç”¨**: ç›´è§‚çš„ API è®¾è®¡
        
        ## æ¶æ„
        
        ```
        Manimlib Modules
        â”œâ”€â”€ Animation Module    # æ ¸å¿ƒåŠ¨ç”»åŠŸèƒ½
        â”œâ”€â”€ Composition Module  # åŠ¨ç”»ç»„åˆå’Œç¼–æ’
        â””â”€â”€ Creation Module     # å¯¹è±¡åˆ›å»ºå’Œæ“ä½œ
        ```
        
        ## å…¼å®¹æ€§
        
        - Python 3.8+
        - NumPy 1.19.0+
        - è·¨å¹³å°æ”¯æŒ (Windows, macOS, Linux)
        EOF
        
        # å®‰è£…æŒ‡å—
        cat > docs/source/installation.md << 'EOF'
        # å®‰è£…æŒ‡å—
        
        ## ç³»ç»Ÿè¦æ±‚
        
        - Python 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
        - NumPy 1.19.0 æˆ–æ›´é«˜ç‰ˆæœ¬
        
        ## å®‰è£…æ–¹æ³•
        
        ### ä» PyPI å®‰è£…ï¼ˆæ¨èï¼‰
        
        ```bash
        pip install manimlib-animation
        pip install manimlib-composition
        pip install manimlib-creation
        ```
        
        ### ä»æºç å®‰è£…
        
        ```bash
        git clone https://github.com/your-repo/manimlib-modules.git
        cd manimlib-modules
        
        # å®‰è£…å„ä¸ªæ¨¡å—
        pip install ./animation_package/
        pip install ./compositionbuild_package/
        pip install ./creation_package/
        ```
        
        ### å¼€å‘ç¯å¢ƒå®‰è£…
        
        ```bash
        git clone https://github.com/your-repo/manimlib-modules.git
        cd manimlib-modules
        
        # åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
        python -m venv venv
        source venv/bin/activate  # Windows: venv\Scripts\activate
        
        # å®‰è£…å¼€å‘ä¾èµ–
        pip install -r requirements-dev.txt
        
        # ä»¥å¼€å‘æ¨¡å¼å®‰è£…
        pip install -e ./animation_package/
        pip install -e ./compositionbuild_package/
        pip install -e ./creation_package/
        ```
        
        ## éªŒè¯å®‰è£…
        
        ```python
        import animation
        import composition
        import creation
        
        print(f"Animation v{animation.__version__}")
        print(f"Composition v{composition.__version__}")
        print(f"Creation v{creation.__version__}")
        ```
        EOF
        
        # å¿«é€Ÿå¼€å§‹
        cat > docs/source/quickstart.md << 'EOF'
        # å¿«é€Ÿå¼€å§‹
        
        æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å¿«é€Ÿä¸Šæ‰‹ Manimlib Modulesã€‚
        
        ## åŸºæœ¬ä½¿ç”¨
        
        ### å¯¼å…¥æ¨¡å—
        
        ```python
        import animation
        import composition
        import creation
        ```
        
        ### è¿è¡Œç¤ºä¾‹
        
        æ¯ä¸ªæ¨¡å—éƒ½åŒ…å«å†…ç½®çš„ä½¿ç”¨ç¤ºä¾‹ï¼š
        
        ```python
        # è¿è¡ŒåŠ¨ç”»æ¨¡å—ç¤ºä¾‹
        animation._usage_example()
        
        # è¿è¡Œç»„åˆæ¨¡å—ç¤ºä¾‹
        composition._usage_example()
        
        # è¿è¡Œåˆ›å»ºæ¨¡å—ç¤ºä¾‹
        creation._usage_example()
        ```
        
        ### æ¨¡å—è‡ªæµ‹è¯•
        
        éªŒè¯æ¨¡å—åŠŸèƒ½ï¼š
        
        ```python
        # è¿è¡Œè‡ªæµ‹è¯•
        animation._module_self_test()
        composition._module_self_test()
        creation._module_self_test()
        ```
        
        ## ä¸‹ä¸€æ­¥
        
        - æŸ¥çœ‹ [API å‚è€ƒ](api/index.rst) äº†è§£è¯¦ç»†åŠŸèƒ½
        - æµè§ˆ [ç¤ºä¾‹é›†åˆ](examples/index.rst) å­¦ä¹ æœ€ä½³å®è·µ
        - é˜…è¯» [è´¡çŒ®æŒ‡å—](contributing.rst) å‚ä¸å¼€å‘
        EOF
        
        # è´¡çŒ®æŒ‡å—
        cat > docs/source/contributing.rst << 'EOF'
        è´¡çŒ®æŒ‡å—
        ========
        
        æ„Ÿè°¢æ‚¨å¯¹ Manimlib Modules çš„å…³æ³¨ï¼æˆ‘ä»¬æ¬¢è¿å„ç§å½¢å¼çš„è´¡çŒ®ã€‚
        
        å¼€å‘ç¯å¢ƒè®¾ç½®
        ------------
        
        1. Fork é¡¹ç›®ä»“åº“
        2. å…‹éš†æ‚¨çš„ fork::
        
            git clone https://github.com/your-username/manimlib-modules.git
            cd manimlib-modules
        
        3. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ::
        
            python -m venv venv
            source venv/bin/activate  # Windows: venv\Scripts\activate
        
        4. å®‰è£…å¼€å‘ä¾èµ–::
        
            pip install -r requirements-dev.txt
        
        ä»£ç è§„èŒƒ
        --------
        
        - ä½¿ç”¨ Black è¿›è¡Œä»£ç æ ¼å¼åŒ–
        - ä½¿ç”¨ isort æ•´ç†å¯¼å…¥è¯­å¥
        - ä½¿ç”¨ MyPy è¿›è¡Œç±»å‹æ£€æŸ¥
        - ä½¿ç”¨ Flake8 è¿›è¡Œä»£ç é£æ ¼æ£€æŸ¥
        
        è¿è¡Œæ£€æŸ¥::
        
            black *.py
            isort *.py
            mypy *.py
            flake8 *.py
        
        æµ‹è¯•
        ----
        
        è¿è¡Œæµ‹è¯•å¥—ä»¶::
        
            python -m pytest
        
        æäº¤æ›´æ”¹
        --------
        
        1. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯::
        
            git checkout -b feature/your-feature-name
        
        2. æäº¤æ›´æ”¹::
        
            git commit -m "Add your feature"
        
        3. æ¨é€åˆ°æ‚¨çš„ fork::
        
            git push origin feature/your-feature-name
        
        4. åˆ›å»º Pull Request
        
        æŠ¥å‘Šé—®é¢˜
        --------
        
        è¯·åœ¨ GitHub Issues ä¸­æŠ¥å‘Š bug æˆ–æå‡ºåŠŸèƒ½è¯·æ±‚ã€‚
        EOF
        
        # å˜æ›´æ—¥å¿—ï¼ˆå¦‚æœå­˜åœ¨çš„è¯å¤åˆ¶ï¼‰
        if [ -f "CHANGELOG.md" ]; then
          cp CHANGELOG.md docs/source/changelog.md
        else
          echo "# å˜æ›´æ—¥å¿—\n\nè¯¦ç»†çš„å˜æ›´æ—¥å¿—è¯·æŸ¥çœ‹é¡¹ç›®ä»“åº“ã€‚" > docs/source/changelog.md
        fi
        
    - name: Generate examples documentation
      run: |
        mkdir -p docs/source/examples
        
        cat > docs/source/examples/index.rst << 'EOF'
        ç¤ºä¾‹é›†åˆ
        ========
        
        è¿™é‡Œæ”¶é›†äº† Manimlib Modules çš„å„ç§ä½¿ç”¨ç¤ºä¾‹ã€‚
        
        .. toctree::
           :maxdepth: 2
        
           basic_usage
           advanced_examples
           best_practices
        EOF
        
        # åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹
        cat > docs/source/examples/basic_usage.md << 'EOF'
        # åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹
        
        ## Animation Module åŸºç¡€
        
        ```python
        import animation
        
        # æŸ¥çœ‹æ¨¡å—ä¿¡æ¯
        print(f"Animation Module v{animation.__version__}")
        print(f"Author: {animation.__author__}")
        print(f"Available classes: {animation.__all__}")
        
        # è¿è¡Œå†…ç½®ç¤ºä¾‹
        animation._usage_example()
        ```
        
        ## Composition Module åŸºç¡€
        
        ```python
        import composition
        
        # åˆ›å»ºåŠ¨ç”»ç»„
        # å…·ä½“ç¤ºä¾‹è¯·å‚è€ƒæ¨¡å—æ–‡æ¡£
        composition._usage_example()
        ```
        
        ## Creation Module åŸºç¡€
        
        ```python
        import creation
        
        # åˆ›å»ºå¯¹è±¡
        # å…·ä½“ç¤ºä¾‹è¯·å‚è€ƒæ¨¡å—æ–‡æ¡£
        creation._usage_example()
        ```
        EOF
        
        # é«˜çº§ç¤ºä¾‹
        cat > docs/source/examples/advanced_examples.md << 'EOF'
        # é«˜çº§ç¤ºä¾‹
        
        ## æ¨¡å—ç»„åˆä½¿ç”¨
        
        ```python
        import animation
        import composition
        import creation
        
        # ç»„åˆä½¿ç”¨å¤šä¸ªæ¨¡å—çš„ç¤ºä¾‹
        # å…·ä½“å®ç°è¯·å‚è€ƒå„æ¨¡å—çš„ _usage_example() å‡½æ•°
        ```
        
        ## æ€§èƒ½ä¼˜åŒ–
        
        ```python
        # æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–ç¤ºä¾‹
        import time
        
        def benchmark_modules():
            start = time.time()
            # æ‰§è¡Œæ“ä½œ
            end = time.time()
            print(f"æ‰§è¡Œæ—¶é—´: {end - start:.3f}s")
        ```
        EOF
        
        # æœ€ä½³å®è·µ
        cat > docs/source/examples/best_practices.md << 'EOF'
        # æœ€ä½³å®è·µ
        
        ## é”™è¯¯å¤„ç†
        
        ```python
        try:
            import animation
            animation._module_self_test()
        except ImportError as e:
            print(f"æ¨¡å—å¯¼å…¥å¤±è´¥: {e}")
        except Exception as e:
            print(f"è¿è¡Œæ—¶é”™è¯¯: {e}")
        ```
        
        ## ç±»å‹æ³¨è§£
        
        ```python
        from typing import List, Optional
        import numpy as np
        
        def process_animation_data(data: np.ndarray) -> Optional[List[float]]:
            """å¤„ç†åŠ¨ç”»æ•°æ®çš„ç¤ºä¾‹å‡½æ•°"""
            if data.size == 0:
                return None
            return data.tolist()
        ```
        
        ## æ–‡æ¡£å­—ç¬¦ä¸²
        
        ```python
        def example_function(param1: int, param2: str = "default") -> bool:
            """
            ç¤ºä¾‹å‡½æ•°çš„æ–‡æ¡£å­—ç¬¦ä¸²ã€‚
            
            Args:
                param1: ç¬¬ä¸€ä¸ªå‚æ•°çš„æè¿°
                param2: ç¬¬äºŒä¸ªå‚æ•°çš„æè¿°ï¼Œæœ‰é»˜è®¤å€¼
                
            Returns:
                è¿”å›å€¼çš„æè¿°
                
            Raises:
                ValueError: å½“å‚æ•°æ— æ•ˆæ—¶æŠ›å‡º
                
            Example:
                >>> result = example_function(42, "test")
                >>> print(result)
                True
            """
            return True
        ```
        EOF
        
    - name: Build documentation
      run: |
        cd docs
        sphinx-build -b html source build/html
        
        # æ£€æŸ¥æ„å»ºç»“æœ
        if [ -f "build/html/index.html" ]; then
          echo "âœ… æ–‡æ¡£æ„å»ºæˆåŠŸ"
          echo "ğŸ“„ ç”Ÿæˆçš„é¡µé¢:"
          find build/html -name "*.html" | head -10
        else
          echo "âŒ æ–‡æ¡£æ„å»ºå¤±è´¥"
          exit 1
        fi
        
    - name: Upload documentation artifacts
      uses: actions/upload-artifact@v3
      with:
        name: documentation
        path: docs/build/html/
        retention-days: 30

  # æ£€æŸ¥æ–‡æ¡£è´¨é‡
  check-docs-quality:
    name: Check Documentation Quality
    runs-on: ubuntu-latest
    timeout-minutes: 10
    needs: [generate-api-docs]
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Download documentation
      uses: actions/download-artifact@v3
      with:
        name: documentation
        path: docs-html/
        
    - name: Install quality check tools
      run: |
        sudo apt-get update
        sudo apt-get install -y linkchecker
        pip install html5lib beautifulsoup4
        
    - name: Check HTML validity
      run: |
        echo "=== HTML æœ‰æ•ˆæ€§æ£€æŸ¥ ==="
        
        python -c "
        import os
        from bs4 import BeautifulSoup
        
        html_files = []
        for root, dirs, files in os.walk('docs-html'):
            for file in files:
                if file.endswith('.html'):
                    html_files.append(os.path.join(root, file))
        
        print(f'æ‰¾åˆ° {len(html_files)} ä¸ª HTML æ–‡ä»¶')
        
        errors = 0
        for html_file in html_files[:10]:  # æ£€æŸ¥å‰10ä¸ªæ–‡ä»¶
            try:
                with open(html_file, 'r', encoding='utf-8') as f:
                    soup = BeautifulSoup(f.read(), 'html.parser')
                    if soup.title:
                        print(f'âœ… {os.path.basename(html_file)}: {soup.title.string}')
                    else:
                        print(f'âš ï¸ {os.path.basename(html_file)}: ç¼ºå°‘æ ‡é¢˜')
            except Exception as e:
                print(f'âŒ {os.path.basename(html_file)}: {e}')
                errors += 1
        
        if errors > 0:
            print(f'å‘ç° {errors} ä¸ªé”™è¯¯')
        else:
            print('âœ… HTML æ–‡ä»¶æ£€æŸ¥é€šè¿‡')
        "
        
    - name: Check internal links
      run: |
        echo "=== å†…éƒ¨é“¾æ¥æ£€æŸ¥ ==="
        
        # ä½¿ç”¨ linkchecker æ£€æŸ¥å†…éƒ¨é“¾æ¥
        linkchecker --check-extern --no-warnings docs-html/index.html || echo "âš ï¸ å‘ç°é“¾æ¥é—®é¢˜"
      continue-on-error: true
      
    - name: Generate documentation report
      run: |
        echo "=== æ–‡æ¡£è´¨é‡æŠ¥å‘Š ===" > docs-quality-report.md
        echo "" >> docs-quality-report.md
        
        # ç»Ÿè®¡æ–‡æ¡£é¡µé¢
        HTML_COUNT=$(find docs-html -name "*.html" | wc -l)
        echo "- ğŸ“„ HTML é¡µé¢æ•°é‡: $HTML_COUNT" >> docs-quality-report.md
        
        # ç»Ÿè®¡æ–‡æ¡£å¤§å°
        DOCS_SIZE=$(du -sh docs-html | cut -f1)
        echo "- ğŸ“¦ æ–‡æ¡£æ€»å¤§å°: $DOCS_SIZE" >> docs-quality-report.md
        
        # æ£€æŸ¥å…³é”®é¡µé¢
        echo "" >> docs-quality-report.md
        echo "## å…³é”®é¡µé¢æ£€æŸ¥" >> docs-quality-report.md
        echo "" >> docs-quality-report.md
        
        key_pages=("index.html" "api/index.html" "examples/index.html")
        for page in "${key_pages[@]}"; do
          if [ -f "docs-html/$page" ]; then
            echo "- âœ… $page" >> docs-quality-report.md
          else
            echo "- âŒ $page (ç¼ºå¤±)" >> docs-quality-report.md
          fi
        done
        
        echo "" >> docs-quality-report.md
        echo "## å»ºè®®" >> docs-quality-report.md
        echo "" >> docs-quality-report.md
        echo "1. å®šæœŸæ›´æ–°æ–‡æ¡£å†…å®¹" >> docs-quality-report.md
        echo "2. æ£€æŸ¥å¹¶ä¿®å¤æŸåçš„é“¾æ¥" >> docs-quality-report.md
        echo "3. æ·»åŠ æ›´å¤šç¤ºä¾‹å’Œæ•™ç¨‹" >> docs-quality-report.md
        echo "4. ä¿æŒ API æ–‡æ¡£ä¸ä»£ç åŒæ­¥" >> docs-quality-report.md
        
        cat docs-quality-report.md
        
    - name: Upload quality report
      uses: actions/upload-artifact@v3
      with:
        name: docs-quality-report
        path: docs-quality-report.md

  # éƒ¨ç½²åˆ° GitHub Pages
  deploy-docs:
    name: Deploy to GitHub Pages
    runs-on: ubuntu-latest
    timeout-minutes: 10
    needs: [generate-api-docs, check-docs-quality]
    if: |
      (github.ref == 'refs/heads/main' && github.event_name == 'push') ||
      (github.event_name == 'release' && github.event.action == 'published') ||
      (github.event_name == 'workflow_dispatch' && github.event.inputs.deploy_docs == 'true')
    
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
    - name: Download documentation
      uses: actions/download-artifact@v3
      with:
        name: documentation
        path: docs-html/
        
    - name: Setup Pages
      uses: actions/configure-pages@v3
      
    - name: Upload to GitHub Pages
      uses: actions/upload-pages-artifact@v2
      with:
        path: docs-html/
        
    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v2
      
    - name: Generate deployment summary
      run: |
        echo "=== æ–‡æ¡£éƒ¨ç½²æˆåŠŸ ==="
        echo "ğŸ“– æ–‡æ¡£ URL: ${{ steps.deployment.outputs.page_url }}"
        echo "ğŸ•’ éƒ¨ç½²æ—¶é—´: $(date)"
        echo "ğŸ“¦ éƒ¨ç½²åˆ†æ”¯: ${{ github.ref }}"
        echo "ğŸ”„ è§¦å‘äº‹ä»¶: ${{ github.event_name }}"

  # æ€»ç»“
  summary:
    name: Documentation Summary
    runs-on: ubuntu-latest
    timeout-minutes: 5
    needs: [generate-api-docs, check-docs-quality, deploy-docs]
    if: always()
    
    steps:
    - name: Generate summary
      run: |
        echo "=== Documentation Workflow Summary ==="
        echo "API Docs Generation: ${{ needs.generate-api-docs.result }}"
        echo "Quality Check: ${{ needs.check-docs-quality.result }}"
        echo "Deployment: ${{ needs.deploy-docs.result }}"
        
        if [[ "${{ needs.generate-api-docs.result }}" == "success" ]]; then
          echo "âœ… æ–‡æ¡£ç”ŸæˆæˆåŠŸ"
        else
          echo "âŒ æ–‡æ¡£ç”Ÿæˆå¤±è´¥"
        fi
        
        if [[ "${{ needs.check-docs-quality.result }}" == "success" ]]; then
          echo "âœ… æ–‡æ¡£è´¨é‡æ£€æŸ¥é€šè¿‡"
        else
          echo "âš ï¸ æ–‡æ¡£è´¨é‡æ£€æŸ¥å‘ç°é—®é¢˜"
        fi
        
        if [[ "${{ needs.deploy-docs.result }}" == "success" ]]; then
          echo "âœ… æ–‡æ¡£éƒ¨ç½²æˆåŠŸ"
          echo "ğŸ“– è®¿é—®åœ°å€: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/"
        elif [[ "${{ needs.deploy-docs.result }}" == "skipped" ]]; then
          echo "â­ï¸ æ–‡æ¡£éƒ¨ç½²å·²è·³è¿‡ï¼ˆä¸æ»¡è¶³éƒ¨ç½²æ¡ä»¶ï¼‰"
        else
          echo "âŒ æ–‡æ¡£éƒ¨ç½²å¤±è´¥"
        fi
        
        echo "\nğŸ“š æ–‡æ¡£å·¥ä½œæµå®Œæˆï¼"